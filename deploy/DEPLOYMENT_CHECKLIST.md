# 部署检查清单 📋

使用此清单确保后端服务已成功部署并正常运行。

---

## 🚀 部署前准备

### 代码检查

- [ ] 代码已提交到本地 Git
- [ ] 代码已推送到 GitHub 远程仓库
- [ ] `go.mod` 和 `go.sum` 文件已提交
- [ ] 所有依赖项在 `go.mod` 中正确列出
- [ ] 代码可以在本地成功编译 (`go build main.go`)
- [ ] 没有硬编码的敏感信息（如密码、API 密钥）

### 环境变量准备

- [ ] `.env.example` 文件已创建并提交到 Git
- [ ] `.env` 文件已添加到 `.gitignore`
- [ ] 所有必需的环境变量已文档化
- [ ] 明确了云端部署时需要配置的环境变量

---

## ☁️ 云平台配置 (Render.com)

### 账号设置

- [ ] Render 账号已创建
- [ ] GitHub 账号已连接
- [ ] GitHub 仓库访问权限已授权

### 数据库设置

- [ ] PostgreSQL 数据库已创建
- [ ] 数据库名称设置正确 (`tourism_recommender`)
- [ ] 数据库用户名设置正确 (`tourism_user`)
- [ ] 区域选择合适（建议 Singapore）
- [ ] 免费计划已选择
- [ ] 数据库状态为 "Available"
- [ ] 数据库连接信息已记录

### Web 服务设置

- [ ] Web 服务已创建
- [ ] GitHub 仓库已正确连接
- [ ] 分支设置为 `main`
- [ ] Runtime 设置为 `Go`
- [ ] Build Command 正确：`go build -o main main.go`
- [ ] Start Command 正确：`./main`
- [ ] 区域与数据库相同

### 环境变量配置

#### 必需变量

- [ ] `DB_PASSWORD` 已设置（从数据库页面复制）

#### 应用配置

- [ ] `GIN_MODE` 设置为 `release`
- [ ] `SERVER_PORT` 设置为 `8080`

#### 数据库配置

- [ ] `DB_HOST` 已设置（从数据库页面复制）
- [ ] `DB_PORT` 设置为 `5432`
- [ ] `DB_USER` 已设置（从数据库页面复制）
- [ ] `DB_NAME` 设置为 `tourism_recommender`
- [ ] `DB_SSLMODE` 设置为 `require`

#### 管理员配置

- [ ] `DEFAULT_ADMIN_USERNAME` 已设置（推荐：`admin`）
- [ ] `DEFAULT_ADMIN_PASSWORD` 已设置（使用强密码）
- [ ] `DEFAULT_ADMIN_EMAIL` 已设置

#### 二维码配置

- [ ] `BASE_URL` 已设置为部署后的 URL
- [ ] `WX_APP_ID` 已设置（从小程序后台获取）
- [ ] `WX_APP_PATH` 已设置（推荐：`pages/recommendor/detail`）

---

## ✅ 部署验证

### 构建状态

- [ ] 构建过程成功完成
- [ ] 没有构建错误或警告
- [ ] 构建时间在合理范围内（通常 < 5 分钟）

### 服务状态

- [ ] 服务状态显示为 "Live"
- [ ] 服务已分配 URL（如 `https://your-app.onrender.com`）
- [ ] 服务运行时间 > 1 分钟（确保稳定）

### 日志检查

- [ ] 启动日志中没有错误信息
- [ ] 数据库连接成功
- [ ] 数据库迁移成功执行
- [ ] 服务在指定端口（8080）上监听
- [ ] 没有 panic 或崩溃信息

---

## 🔍 功能测试

### 健康检查

- [ ] 健康检查端点可访问：
  ```bash
  curl https://your-app.onrender.com/api/v1/health
  ```
- [ ] 返回正确的响应：
  ```json
  {
    "status": "ok",
    "message": "Tourism Recommender API is running"
  }
  ```

### API 端点测试

#### 推荐官接口

- [ ] 获取推荐官列表：
  ```bash
  curl https://your-app.onrender.com/api/recommendors
  ```
- [ ] 返回状态码 200
- [ ] 返回数据格式正确（数组）

- [ ] 获取推荐官详情：
  ```bash
  curl https://your-app.onrender.com/api/recommendors/1
  ```
- [ ] 返回状态码 200 或 404（如果不存在）
- [ ] 返回数据格式正确（对象）

#### 目的地接口

- [ ] 获取目的地列表：
  ```bash
  curl https://your-app.onrender.com/api/destinations
  ```
- [ ] 返回状态码 200
- [ ] 返回数据格式正确

### 数据库连接测试

- [ ] 数据库连接成功
- [ ] 可以查询数据
- [ ] 可以插入数据（如有需要）

---

## 📱 小程序配置

### API 地址更新

- [ ] 打开 `wxapp/app.js`
- [ ] 修改 `apiBaseUrl` 为部署后的 URL：
  ```javascript
  apiBaseUrl: "https://your-app.onrender.com/api",
  ```
- [ ] 保存文件

### 小程序功能测试

- [ ] 小程序可以启动
- [ ] 可以获取推荐官列表
- [ ] 可以查看推荐官详情
- [ ] 可以获取推荐的目的地
- [ ] 二维码生成功能正常
- [ ] 扫码功能正常

### 网络请求测试

- [ ] 没有网络错误
- [ ] 没有跨域（CORS）错误
- [ ] 数据加载速度可接受

---

## 🔒 安全验证

### 基本安全

- [ ] 使用 HTTPS 访问 API
- [ ] 默认管理员密码已修改
- [ ] 数据库密码使用强密码
- [ ] 敏感信息没有暴露在日志中

### 访问控制

- [ ] 管理接口需要认证
- [ ] 公开接口可以正常访问
- [ ] CORS 配置正确（如有需要）

---

## 📊 性能验证

### 响应时间

- [ ] 健康检查响应 < 500ms
- [ ] 推荐官列表响应 < 2s
- [ ] 推荐官详情响应 < 1s

### 资源使用

- [ ] CPU 使用率在正常范围
- [ ] 内存使用在正常范围
- [ ] 没有内存泄漏迹象

---

## 🛠️ 维护配置

### 监控设置

- [ ] 服务健康检查已配置
- [ ] 错误日志已启用
- [ ] 日志级别设置合理

### 备份策略

- [ ] 数据库备份已配置（如果平台支持）
- [ ] 知道如何手动备份数据
- [ ] 备份恢复流程已测试

---

## 📝 文档更新

### 部署文档

- [ ] 部署 URL 已记录
- [ ] 数据库连接信息已记录
- [ ] 环境变量配置已记录
- [ ] 部署日期已记录

### 团队文档

- [ ] 团队成员知晓新部署
- [ ] 访问权限已分配（如需要）
- [ ] 使用说明已更新

---

## 🎯 最终验证

### 端到端测试

- [ ] 完整的用户流程可测试
- [ ] 所有主要功能正常工作
- [ ] 错误处理正常
- [ ] 边界情况处理正常

### 用户验收

- [ ] 基本需求已满足
- [ ] 用户体验可接受
- [ ] 性能满足预期
- [ ] 可以开始使用

---

## ✨ 完成标记

当所有项目都勾选后，你的部署就完成了！🎉

- **部署日期**: _______________
- **部署人员**: _______________
- **部署 URL**: _______________
- **状态**: ✅ 成功 / ❌ 失败

---

## 📞 遇到问题？

如果在部署过程中遇到问题：

1. 查看部署日志获取详细错误信息
2. 参考常见问题文档
3. 检查环境变量配置
4. 验证数据库连接
5. 联系技术支持

---

**祝你部署顺利！** 🚀