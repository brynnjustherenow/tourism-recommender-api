<!--pages/recommendor/detail.wxml-->
<view class="container">
  <!-- è¿”å›æŒ‰é’® -->
  
  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content" wx:if="{{!loading && recommendor}}">
    <!-- å¤´éƒ¨å¡ç‰‡ -->
    <view class="header-card">
      <view class="avatar-section">
        <image
          class="avatar"
          src="{{recommendor.avatar}}"
          mode="aspectFill"
          bindtap="onPreviewAvatar"
        ></image>
        <view class="rating-display">
          <text class="rating-score">{{recommendor.rating ? recommendor.rating.toFixed(1) : '0.0'}}</text>
          <view class="stars">
            <block wx:for="{{recommendor.stars}}" wx:key="index">
              <text class="star filled" wx:if="{{item.filled}}">â˜…</text>
              <text class="star half" wx:elif="{{item.half}}">â˜…</text>
              <text class="star" wx:else>â˜…</text>
            </block>
          </view>
        </view>
      </view>

      <view class="info-section">
        <view class="name-row">
          <text class="name">{{recommendor.name}}</text>
          <view class="status-tag active" wx:if="{{recommendor.status === 'active'}}">æ´»è·ƒä¸­</view>
          <view class="status-tag inactive" wx:else>éæ´»è·ƒ</view>
        </view>

        <view class="bio" wx:if="{{recommendor.bio}}">
          <text class="bio-label">ç®€ä»‹</text>
          <text class="bio-text">{{recommendor.bio}}</text>
        </view>
      </view>
    </view>

    <!-- è¯¦ç»†ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="card-title">è¯¦ç»†ä¿¡æ¯</view>

      <view class="info-group">
        <view class="info-item">
          <text class="info-label">å§“å</text>
          <text class="info-value">{{recommendor.name}}</text>
        </view>

        <view class="info-item">
          <text class="info-label">æ€§åˆ«</text>
          <text class="info-value">
            {{recommendor.gender === 'male' ? 'ç”·' : recommendor.gender === 'female' ? 'å¥³' : 'å…¶ä»–'}}
          </text>
        </view>

        <view class="info-item">
          <text class="info-label">å¹´é¾„</text>
          <text class="info-value">{{recommendor.age}} å²</text>
        </view>

        <view class="info-item">
          <text class="info-label">è¯ä»¶å·</text>
          <text class="info-value">{{recommendor.id_number}}</text>
        </view>

        <view class="info-item">
          <text class="info-label">ç”µè¯</text>
          <text class="info-value phone" bindtap="onCopyPhone">
            {{recommendor.phone || '-'}}
          </text>
        </view>

        <view class="info-item">
          <text class="info-label">é‚®ç®±</text>
          <text class="info-value email" bindtap="onCopyEmail">
            {{recommendor.email || '-'}}
          </text>
        </view>

        <view class="info-item">
          <text class="info-label">åœ°åŒº</text>
          <text class="info-value">{{recommendor.region_address || '-'}}</text>
        </view>

        <view class="info-item">
          <text class="info-label">è¯„åˆ†</text>
          <text class="info-value">{{recommendor.rating ? recommendor.rating.toFixed(1) : '0.0'}} / 5.0</text>
        </view>

        <view class="info-item">
          <text class="info-label">æœ‰æ•ˆæœŸ</text>
          <text class="info-value">
            {{recommendor.valid_from}}
            è‡³
            {{recommendor.valid_until}}
          </text>
        </view>

        <view class="info-item">
          <text class="info-label">æ³¨å†Œæ—¶é—´</text>
          <text class="info-value">{{recommendor.created_at}}</text>
        </view>
      </view>
    </view>

    <!-- äºŒç»´ç å¡ç‰‡ -->
    <view class="qrcode-card">
      <view class="card-title">æ‰«ç è”ç³»</view>

      <view class="qrcode-list">
        <view class="qrcode-item">
          <text class="qrcode-label">ğŸ”— ç½‘é¡µäºŒç»´ç </text>
          <view class="qrcode-wrapper" wx:if="{{recommendor.qr_code_web}}">
            <image
              class="qrcode-image"
              src="{{recommendor.qr_code_web}}"
              mode="aspectFit"
              bindtap="onPreviewQRCode"
              data-url="{{recommendor.qr_code_web}}"
            ></image>
          </view>
          <view class="qrcode-empty" wx:else>
            <text>æš‚æ— äºŒç»´ç </text>
          </view>
          <text class="qrcode-tip">æ‰«ç è·³è½¬åˆ°ç½‘é¡µè¯¦æƒ…é¡µ</text>
          <button
            class="save-qrcode-btn"
            wx:if="{{recommendor.qr_code_web}}"
            bindtap="onSaveQRCode"
            data-url="{{recommendor.qr_code_web}}"
          >
            ä¿å­˜åˆ°ç›¸å†Œ
          </button>
        </view>

        <view class="qrcode-item">
          <text class="qrcode-label">ğŸ’  å°ç¨‹åºäºŒç»´ç </text>
          <view class="qrcode-wrapper" wx:if="{{recommendor.qr_code_wxapp}}">
            <image
              class="qrcode-image"
              src="{{recommendor.qr_code_wxapp}}"
              mode="aspectFit"
              bindtap="onPreviewQRCode"
              data-url="{{recommendor.qr_code_wxapp}}"
            ></image>
          </view>
          <view class="qrcode-empty" wx:else>
            <text>æš‚æ— äºŒç»´ç </text>
          </view>
          <text class="qrcode-tip">æ‰«ç è·³è½¬åˆ°å°ç¨‹åºè¯¦æƒ…é¡µ</text>
          <button
            class="save-qrcode-btn"
            wx:if="{{recommendor.qr_code_wxapp}}"
            bindtap="onSaveQRCode"
            data-url="{{recommendor.qr_code_wxapp}}"
          >
            ä¿å­˜åˆ°ç›¸å†Œ
          </button>
        </view>
      </view>
    </view>

    <!-- æ¨èç›®çš„åœ°å¡ç‰‡ -->
    <view class="destinations-card">
      <view class="card-title">æ¨èç›®çš„åœ°</view>

      <!-- åŠ è½½ä¸­ -->
      <view class="loading-container" wx:if="{{destinationsLoading && destinations.length === 0}}">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>

      <!-- ç›®çš„åœ°åˆ—è¡¨ -->
      <view class="destinations-list" wx:elif="{{destinations.length > 0}}">
        <view
          class="destination-card"
          wx:for="{{destinations}}"
          wx:key="id"
        >
          <!-- ç›®çš„åœ°å›¾ç‰‡ -->
          <view
            class="destination-image-wrapper"
            bindtap="onPreviewDestinationImage"
            data-url="{{item.image}}"
            data-images="{{[item.image]}}"
          >
            <image
              class="destination-image"
              src="{{item.image}}"
              mode="aspectFill"
            ></image>
          </view>

          <!-- ç›®çš„åœ°ä¿¡æ¯ -->
          <view class="destination-info">
            <view class="destination-name">{{item.name}}</view>

            <view class="destination-desc" wx:if="{{item.description}}">
              {{item.description}}
            </view>

            <view class="destination-meta">
              <view class="destination-rating">
                <view class="mini-stars">
                  <block wx:for="{{item.stars}}" wx:key="index">
                    <text class="mini-star filled" wx:if="{{item.filled}}">â˜…</text>
                    <text class="mini-star half" wx:elif="{{item.half}}">â˜…</text>
                    <text class="mini-star" wx:else>â˜…</text>
                  </block>
                </view>
                <text class="mini-rating-score">{{item.rating ? item.rating.toFixed(1) : '0.0'}}</text>
              </view>

              <view
                class="destination-tags"
                wx:if="{{item.tags && item.tags.length > 0}}"
              >
                <text
                  class="destination-tag"
                  wx:for="{{item.tags.slice(0, 2)}}"
                  wx:key="*this"
                  wx:for-item="tag"
                >
                  {{tag}}
                </text>
                <text
                  class="destination-tag more"
                  wx:if="{{item.tags.length > 2}}"
                >
                  +{{item.tags.length - 2}}
                </text>
              </view>
            </view>

            <!-- æŸ¥çœ‹è¯¦æƒ…æŒ‰é’® -->
            <view
              class="view-detail-btn"
              bindtap="onViewDestination"
              data-id="{{item.id}}"
            >
              <text>ğŸ‘ï¸ æŸ¥çœ‹è¯¦æƒ…</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-container" wx:elif="{{destinations.length === 0 && !destinationsLoading}}">
        <text class="empty-text">æš‚æ— æ¨èçš„ç›®çš„åœ°</text>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{destinations.length > 0}}">
        <text class="load-more-text" wx:if="{{destinationsLoading && destinations.length > 0}}">åŠ è½½ä¸­...</text>
        <text class="load-more-text" wx:elif="{{!destinationsHasMore}}">æ²¡æœ‰æ›´å¤šäº†</text>
        <text class="load-more-text" wx:else>ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
      </view>
    </view>
  </view>
</view>
